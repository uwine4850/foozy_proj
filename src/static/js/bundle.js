(()=>{"use strict";var t={391:(t,e,n)=>{n.r(e)},872:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ajaxGET=e.Ajax=void 0;var n=function(){function t(t,e){this.path=t,this.formId=e}return t.prototype.onSuccess=function(t){this.onSuccessFn=t},t.prototype.onError=function(t){this.onErrorFn=t},t.prototype.listen=function(){var t=this;$(document).ready((function(){$("#"+t.formId).submit((function(e){e.preventDefault();var n=$(t).serialize();$.ajax({type:"POST",url:t.path,data:n,success:function(e){t.onSuccessFn(e)},error:function(e,n,o){t.onErrorFn(o)}})}))}))},t}();e.Ajax=n,e.ajaxGET=function(t,e,n,o){$.ajax({url:t,method:"GET",data:e,json:!0,success:function(t){n(t)},error:function(t,e,n){o(n)}})}},862:(t,e)=>{var n,o,s;Object.defineProperty(e,"__esModule",{value:!0}),e.RunWs=void 0,function(t){t[t.Connect=0]="Connect",t[t.TextMsg=1]="TextMsg"}(n||(n={})),e.RunWs=function(){var t=document.getElementById("chat-textarea"),e=new WebSocket("ws://localhost:8000/chat-ws");e.addEventListener("open",(function(t){console.log("Connect.")})),e.addEventListener("message",(function(t){var e=JSON.parse(t.data);switch(e.Type){case n.TextMsg:e.Uid==o?document.getElementById("chat-content").innerHTML+=' <div class="chat-content-msg chat-content-msg-my-msg">\n                        <div class="chat-content-msg-text">\n                            '.concat(e.Msg.Text,'\n                        </div>\n                        <div class="chat-content-msg-date">1/22/3333</div>\n                    </div>'):document.getElementById("chat-content").innerHTML+=' <div class="chat-content-msg">\n                        <div class="chat-content-msg-text">\n                            '.concat(e.Msg.Text,'\n                        </div>\n                        <div class="chat-content-msg-date">1/22/3333</div>\n                    </div>');break;case n.Connect:o=e.Uid,s=e.ChatId}})),e.addEventListener("close",(function(t){console.log("Close.")})),e.addEventListener("error",(function(t){console.error("Error:",t)})),document.getElementById("send").onclick=function(){var c={Type:n.TextMsg,Uid:o,ChatId:s,Msg:{Text:t.value}};e.send(JSON.stringify(c)),t.value=""}}},896:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LazyLoad=e.handleIntersection=void 0;var o=n(872);e.handleIntersection=function(t,e){t.forEach((function(t){t.isIntersecting&&(console.log("Элемент появился на экране:",t.target),e.unobserve(t.target))}))};var s=function(){function t(t,e,n){this.obsElementId=t,this.dataFields=e,this.url=n}return t.prototype.setOptions=function(t){this.options=t},t.prototype.getValues=function(t){for(var e={},n=0,o=this.dataFields;n<o.length;n++){var s=o[n],c=t.getAttribute("data-"+s);null!=c&&(e[s]=c)}return e},t.prototype.run=function(t,e){var n=this,s=document.getElementById(this.obsElementId);new IntersectionObserver((function(c,i){c.forEach((function(c){c.isIntersecting&&(i.unobserve(c.target),(0,o.ajaxGET)(n.url,n.getValues(s),(function(e){t(e)}),(function(t){e(t)})),s.removeAttribute("id"),setTimeout((function(){(s=document.getElementById(n.obsElementId))&&i.observe(s)}),100))}))}),{root:null,threshold:.5}).observe(s)},t}();e.LazyLoad=s},779:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.runIfExist=void 0,e.runIfExist=function(t,e){t&&e(t)}}},e={};function n(o){var s=e[o];if(void 0!==s)return s.exports;var c=e[o]={exports:{}};return t[o](c,c.exports,n),c.exports}n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{n(391);var t=n(779),e=n(872),o=n(862),s=n(896);(0,t.runIfExist)(document.getElementById("header-user"),(function(t){t.onclick=function(){document.getElementById("hu-menu").classList.toggle("hu-menu-hidden")}})),(0,t.runIfExist)(document.getElementById("pc-menu-filter-value"),(function(t){t.onclick=function(){document.getElementById("filter-items").classList.toggle("filter-items-hidden")}})),(0,t.runIfExist)(document.getElementById("pp-del-avatar-label"),(function(t){t.onclick=function(){document.getElementById("pp-del-avatar").classList.toggle("page-panel-checkbox-true")}}));var c=new e.Ajax("/subscribe-post","subscribe-post");if(c.onSuccess((function(t){var e=document.getElementById("profile-button-subscribe"),n=document.getElementById("subscribers-value"),o=parseInt(n.innerHTML);e.classList.toggle("profile-button-unsubscribe"),e.classList.contains("profile-button-unsubscribe")?(o++,e.innerHTML='<a><img src="/static/img/subscribe.svg">Unsubscribe</a>'):(o>0&&o--,e.innerHTML='<a><img src="/static/img/subscribe.svg">Subscribe</a>'),n.innerHTML=String(o)})),c.listen(),/^\/chat\/\d+$/.test(window.location.pathname)&&((0,o.RunWs)(),document.getElementById("last-msg"))){var i=new s.LazyLoad("last-msg",["uid","chatid","msgid"],"/load-messages");i.setOptions({root:null,threshold:.5}),i.run((function(t){var e=document.getElementById("chat-content");if(t.error)console.log(t.error);else{var n=e.scrollTop,o=e.scrollHeight;if(t.messages)for(var s=t.messages,c=0;c<s.length;c++){var i=void 0,r=void 0;c==s.length-1&&(i='data-chatid="'.concat(t.chatId,'" data-msgid="').concat(s[c].Id,'" id="last-msg"')),t.uid==s[c].UserId&&(r="chat-content-msg-my-msg");var a="\n                        <div ".concat(i,' class="chat-content-msg ').concat(r,'">\n                            <div class="chat-content-msg-text">\n                                ').concat(s[c].Text,'\n                            </div>\n                            <div class="chat-content-msg-date">').concat(s[c].Date,"</div>\n                        </div>");document.getElementById("chat-content").insertAdjacentHTML("afterbegin",a)}var u=e.scrollHeight;e.scrollTop=n+(u-o)}}),(function(t){console.log(t)}))}})()})();